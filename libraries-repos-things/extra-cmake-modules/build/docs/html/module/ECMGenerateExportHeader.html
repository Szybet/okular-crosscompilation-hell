<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ECMGenerateExportHeader &#8212; Extra CMake Modules 5.240.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/ecm.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    
    <link rel="icon" href="../_static/kde-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ECMGenerateHeaders" href="ECMGenerateHeaders.html" />
    <link rel="prev" title="ECMGenerateDBusServiceFile" href="ECMGenerateDBusServiceFile.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ECMGenerateHeaders.html" title="ECMGenerateHeaders"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ECMGenerateDBusServiceFile.html" title="ECMGenerateDBusServiceFile"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">ECM 5.240 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../manual/ecm-modules.7.html" accesskey="U">ecm-modules(7)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ECMGenerateExportHeader</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ecmgenerateexportheader">
<span id="module:ECMGenerateExportHeader"></span><h1>ECMGenerateExportHeader<a class="headerlink" href="#ecmgenerateexportheader" title="Permalink to this heading">¶</a></h1>
<p>This module provides the <code class="docutils literal notranslate"><span class="pre">ecm_generate_export_header</span></code> function for
generating export macros for libraries with version-based control over
visibility of and compiler warnings for deprecated API for the library user,
as well as over excluding deprecated API and their implementation when
building the library itself.</p>
<p>For preparing some values useful in the context it also provides a function
<code class="docutils literal notranslate"><span class="pre">ecm_export_header_format_version</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ecm_generate_export_header</span><span class="p">(</span><span class="o">&lt;</span><span class="n">library_target_name</span><span class="o">&gt;</span>
    <span class="n">VERSION</span> <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
    <span class="p">[</span><span class="n">BASE_NAME</span> <span class="o">&lt;</span><span class="n">base_name</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">GROUP_BASE_NAME</span> <span class="o">&lt;</span><span class="n">group_base_name</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">EXPORT_MACRO_NAME</span> <span class="o">&lt;</span><span class="n">export_macro_name</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">EXPORT_FILE_NAME</span> <span class="o">&lt;</span><span class="n">export_file_name</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">DEPRECATED_MACRO_NAME</span> <span class="o">&lt;</span><span class="n">deprecated_macro_name</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">NO_EXPORT_MACRO_NAME</span> <span class="o">&lt;</span><span class="n">no_export_macro_name</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">INCLUDE_GUARD_NAME</span> <span class="o">&lt;</span><span class="n">include_guard_name</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">STATIC_DEFINE</span> <span class="o">&lt;</span><span class="n">static_define</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">PREFIX_NAME</span> <span class="o">&lt;</span><span class="n">prefix_name</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">DEPRECATED_BASE_VERSION</span> <span class="o">&lt;</span><span class="n">deprecated_base_version</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">DEPRECATION_VERSIONS</span> <span class="o">&lt;</span><span class="n">deprecation_version</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">deprecation_version2</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">...</span><span class="p">]]]</span>
    <span class="p">[</span><span class="n">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span> <span class="o">&lt;</span><span class="n">exclude_deprecated_before_and_at_version</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="n">NO_BUILD_SET_DEPRECATED_WARNINGS_SINCE</span><span class="p">]</span>
    <span class="p">[</span><span class="n">NO_DEFINITION_EXPORT_TO_BUILD_INTERFACE</span><span class="p">]</span>
    <span class="p">[</span><span class="n">USE_VERSION_HEADER</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">version_file_name</span><span class="o">&gt;</span><span class="p">]]</span> <span class="c1">#  Since 5.106</span>
    <span class="p">[</span><span class="n">VERSION_BASE_NAME</span> <span class="o">&lt;</span><span class="n">version_base_name</span><span class="o">&gt;</span><span class="p">]</span> <span class="c1">#  Since 5.106</span>
    <span class="p">[</span><span class="n">VERSION_MACRO_NAME</span> <span class="o">&lt;</span><span class="n">version_macro_name</span><span class="o">&gt;</span><span class="p">]</span> <span class="c1">#  Since 5.106</span>
    <span class="p">[</span><span class="n">CUSTOM_CONTENT_FROM_VARIABLE</span> <span class="o">&lt;</span><span class="n">variable</span><span class="o">&gt;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">VERSION</span></code> specifies the version of the library, given in the format
“&lt;major&gt;.&lt;minor&gt;.&lt;patchlevel&gt;”.</p>
<p><code class="docutils literal notranslate"><span class="pre">GROUP_BASE_NAME</span></code> specifies the name to use for the macros defining
library group default values. If set, this will generate code supporting
<code class="docutils literal notranslate"><span class="pre">&lt;group_base_name&gt;_NO_DEPRECATED_WARNINGS</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;group_base_name&gt;_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;group_base_name&gt;_DEPRECATED_WARNINGS_SINCE</span></code>  and
<code class="docutils literal notranslate"><span class="pre">&lt;group_base_name&gt;_NO_DEPRECATED</span></code> (see below).
If not set, the generated code will ignore any such macros.</p>
<p><code class="docutils literal notranslate"><span class="pre">DEPRECATED_BASE_VERSION</span></code> specifies the default version before and at which
deprecated API is disabled. Possible values are “0”, “CURRENT” (which
resolves to &lt;version&gt;) and a version string in the format
“&lt;major&gt;.&lt;minor&gt;.&lt;patchlevel&gt;”. The default is the value of
“&lt;exclude_deprecated_before_and_at_version&gt;” if set, or “&lt;major&gt;.0.0”, with
&lt;major&gt; taken from &lt;version&gt;.</p>
<p><code class="docutils literal notranslate"><span class="pre">DEPRECATION_VERSIONS</span></code> specifies versions in “&lt;major&gt;.&lt;minor&gt;” format in
which API was declared deprecated. Any version used with the generated
macro <code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;base_name&gt;_DEPRECATED_VERSION(major,</span> <span class="pre">minor,</span> <span class="pre">text)</span></code>
or <code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;base_name&gt;_DEPRECATED_VERSION_BELATED(major,</span> <span class="pre">minor,</span> <span class="pre">textmajor,</span> <span class="pre">textminor,</span> <span class="pre">text)</span></code>
needs to be listed here, otherwise the macro will fail to work.</p>
<p><code class="docutils literal notranslate"><span class="pre">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span></code> specifies the version for which all API
deprecated before and at should be excluded from the build completely.
Possible values are “0” (default), “CURRENT” (which resolves to &lt;version&gt;)
and a version string in the format “&lt;major&gt;.&lt;minor&gt;.&lt;patchlevel&gt;”.</p>
<p><code class="docutils literal notranslate"><span class="pre">NO_BUILD_SET_DEPRECATED_WARNINGS_SINCE</span></code> specifies that the definition
<code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DEPRECATED_WARNINGS_SINCE</span></code> will
not be set for the library inside its own build, and thus will be defined
by either explicit definition in the build system configuration or by the
default value mechanism (see below).
The default is that it is set for the build, to the version specified by
<code class="docutils literal notranslate"><span class="pre">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span></code>, so no deprecation warnings are
done for any own deprecated API used in the library implementation itself.</p>
<p><code class="docutils literal notranslate"><span class="pre">NO_DEFINITION_EXPORT_TO_BUILD_INTERFACE</span></code> specifies that the definition
<code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code> will
not be set in the public interface of the library inside its own build, and
the same for the definition
<code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DEPRECATED_WARNINGS_SINCE</span></code> (if not
disabled by <code class="docutils literal notranslate"><span class="pre">NO_BUILD_SET_DEPRECATED_WARNINGS_SINCE</span></code> already).
The default is that they are set, to the version specified by
<code class="docutils literal notranslate"><span class="pre">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span></code>, so e.g. test and examples part of the
project automatically build against the full API included in the build and
without any deprecation warnings for it.</p>
<p><code class="docutils literal notranslate"><span class="pre">USE_VERSION_HEADER</span></code> defines whether a given header file
<code class="docutils literal notranslate"><span class="pre">&lt;version_file_name&gt;</span></code> providing macros specifying the library version should
be included in the generated header file. By default angle-brackets are used
for the include statement. To generate includes with double quotes, add
double quotes to the argument string (needs escaping), e.g. <code class="docutils literal notranslate"><span class="pre">\&quot;version.h\&quot;</span></code>.
The macro from the included version header holding the library version is
given as <code class="docutils literal notranslate"><span class="pre">&lt;version_macro_name&gt;</span></code> by the argument <code class="docutils literal notranslate"><span class="pre">VERSION_MACRO_NAME</span></code> and
used in the generated code for calculating defaults. If not specified, the
defaults for the version file name and the version macro are derived from
<code class="docutils literal notranslate"><span class="pre">&lt;version_base_name&gt;</span></code> as passed with <code class="docutils literal notranslate"><span class="pre">VERSION_BASE_NAME</span></code>, which again
defaults to <code class="docutils literal notranslate"><span class="pre">&lt;base_name&gt;</span></code> or otherwise <code class="docutils literal notranslate"><span class="pre">&lt;library_target_name&gt;</span></code>.
The macro name defaults to <code class="docutils literal notranslate"><span class="pre">&lt;uppercase_version_base_name&gt;_VERSION</span></code>,
the version file name to <code class="docutils literal notranslate"><span class="pre">&lt;lowercase_version_base_name&gt;_version.h</span></code>.
Since 5.106.</p>
<p><code class="docutils literal notranslate"><span class="pre">CUSTOM_CONTENT_FROM_VARIABLE</span></code> specifies the name of a variable whose
content will be appended at the end of the generated file, before any
final inclusion guard closing. Note that before 5.98 this was broken and
would only append the string passed as argument value.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">ecm_generate_export_header</span></code> defines C++ preprocessor macros
in the generated export header, some for use in the sources of the library
the header is generated for, other for use by projects linking agsinst the
library.</p>
<p>The macros for use in the library C++ sources are these, next to those also
defined by <a class="reference external" href="https://cmake.org/cmake/help/latest/module/GenerateExportHeader.html">GenerateExportHeader</a>:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DEPRECATED_VERSION(major,</span> <span class="pre">minor,</span> <span class="pre">text)</span></code></dt><dd><p>to use to conditionally set a
<code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DEPRECATED</span></code> macro for a class, struct
or function (other elements to be supported in future versions), depending
on the visibility macro flags set (see below)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DEPRECATED_VERSION_BELATED(major,</span> <span class="pre">minor,</span> <span class="pre">textmajor,</span> <span class="pre">textminor,</span> <span class="pre">text)</span></code></dt><dd><p>to use to conditionally set a
<code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DEPRECATED</span></code> macro for a class, struct
or function (other elements to be supported in future versions), depending
on the visibility macro flags set (see below), with <code class="docutils literal notranslate"><span class="pre">major</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">minor</span></code>
applied for the logic and <code class="docutils literal notranslate"><span class="pre">textmajor</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">textminor</span></code> for the warnings message.
Useful for retroactive tagging of API for the compiler without injecting the
API into the compiler warning conditions of already released versions.
Since 5.71.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_ENUMERATOR_DEPRECATED_VERSION(major,</span> <span class="pre">minor,</span> <span class="pre">text)</span></code></dt><dd><p>to use to conditionally set a
<code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DEPRECATED</span></code> macro for an enumerator, depending
on the warnings macro flags set (see below). In builds using C++14 standard or earlier,
where enumerator attributes are not yet supported, the macro will always yield an empty string.
With MSVC it is also always an empty string for now.
Since 5.82.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_ENUMERATOR_DEPRECATED_VERSION_BELATED(major,</span> <span class="pre">minor,</span> <span class="pre">textmajor,</span> <span class="pre">textminor,</span> <span class="pre">text)</span></code></dt><dd><p>to use to conditionally set a
<code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DEPRECATED</span></code> macro for an enumerator, depending
on the warnings macro flags set (see below), with <code class="docutils literal notranslate"><span class="pre">major</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">minor</span></code>
applied for the logic and <code class="docutils literal notranslate"><span class="pre">textmajor</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">textminor</span></code> for the warnings message.
In builds using C++14 standard or earlier, where enumerator attributes are not yet supported,
the macro will always yield an empty string.
Useful for retroactive tagging of API for the compiler without injecting the
API into the compiler warning conditions of already released versions.
With MSVC it is also always an empty string for now.
Since 5.82.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_ENABLE_DEPRECATED_SINCE(major,</span> <span class="pre">minor)</span></code></dt><dd><p>evaluates to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> depending on the visibility macro flags
set (see below). To be used mainly with <code class="docutils literal notranslate"><span class="pre">#if</span></code>/<code class="docutils literal notranslate"><span class="pre">#endif</span></code> to mark sections
of code which should be included depending on the visibility requested.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_BUILD_DEPRECATED_SINCE(major,</span> <span class="pre">minor)</span></code></dt><dd><p>evaluates to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> depending on the value of
<code class="docutils literal notranslate"><span class="pre">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span></code>. To be used mainly with
<code class="docutils literal notranslate"><span class="pre">#if</span></code>/<code class="docutils literal notranslate"><span class="pre">#endif</span></code> to mark sections of two types of code: implementation
code for deprecated API and declaration code of deprecated API which only
may be disabled at build time of the library for BC reasons (e.g. virtual
methods, see notes below).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_EXCLUDE_DEPRECATED_BEFORE_AND_AT</span></code></dt><dd><p>holds the version used to exclude deprecated API at build time of the
library.</p>
</dd>
</dl>
<p>The macros used to control visibility when building against the library are:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code></dt><dd><p>definition to set to a value in single hex number version notation
(<code class="docutils literal notranslate"><span class="pre">0x&lt;major&gt;&lt;minor&gt;&lt;patchlevel&gt;</span></code>).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_NO_DEPRECATED</span></code></dt><dd><p>flag to define to disable all deprecated API, being a shortcut for
settings <code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code>
to the current version. If both are set, this flag overrules.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DEPRECATED_WARNINGS_SINCE</span></code></dt><dd><p>definition to set to a value in single hex number version notation
(<code class="docutils literal notranslate"><span class="pre">0x&lt;major&gt;&lt;minor&gt;&lt;patchlevel&gt;</span></code>). Warnings will be only activated for
API deprecated up to and including the version. If
<code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code>
is set (directly or via the group default), it will default to that
version, resulting in no warnings. Otherwise the default is the current
version, resulting in warnings for all deprecated API.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_NO_DEPRECATED_WARNINGS</span></code></dt><dd><p>flag to define to disable all deprecation warnings, being a shortcut for
setting <code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_DEPRECATED_WARNINGS_SINCE</span></code>
to “0”. If both are set, this flag overrules.</p>
</dd>
</dl>
<p>When the <code class="docutils literal notranslate"><span class="pre">GROUP_BASE_NAME</span></code> has been used, the same macros but with the
given <code class="docutils literal notranslate"><span class="pre">&lt;group_base_name&gt;</span></code> prefix are available to define the defaults of
these macros, if not explicitly set.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The tricks applied here for hiding deprecated API to the compiler
when building against a library do not work for all deprecated API:</p>
<ul class="simple">
<li><p>virtual methods need to stay visible to the compiler to build proper
virtual method tables for subclasses</p></li>
<li><p>enumerators from enums cannot be simply removed, as this changes
auto values of following enumerators, also can poke holes in enumerator
series used as index into tables</p></li>
</ul>
<p>In such cases the API can be only “hidden” at build time of the library,
itself, by generated hard coded macro settings, using
<code class="docutils literal notranslate"><span class="pre">&lt;prefix_name&gt;&lt;uppercase_base_name&gt;_BUILD_DEPRECATED_SINCE(major,</span> <span class="pre">minor)</span></code>.</p>
</div>
<p>Examples:</p>
<p>Preparing a library “Foo” created by target “foo”, which is part of a group
of libraries “Bar”, where some API of “Foo” got deprecated at versions
5.0 &amp; 5.12:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ecm_generate_export_header</span><span class="p">(</span><span class="s">foo</span>
<span class="w">    </span><span class="s">GROUP_BASE_NAME</span><span class="w"> </span><span class="s">BAR</span>
<span class="w">    </span><span class="s">VERSION</span><span class="w"> </span><span class="o">${</span><span class="nv">FOO_VERSION</span><span class="o">}</span>
<span class="w">    </span><span class="s">DEPRECATION_VERSIONS</span><span class="w"> </span><span class="s">5.0</span><span class="w"> </span><span class="s">5.12</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In the library “Foo” sources in the headers the API would be prepared like
this, using the generated macros <code class="docutils literal notranslate"><span class="pre">FOO_ENABLE_DEPRECATED_SINCE</span></code> and
<code class="docutils literal notranslate"><span class="pre">FOO_DEPRECATED_VERSION</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;foo_export.h&gt;</span>

<span class="cp">#if FOO_ENABLE_DEPRECATED_SINCE(5, 0)</span>
<span class="cm">/**</span>
<span class="cm">  * @deprecated Since 5.0</span>
<span class="cm">  */</span>
<span class="n">FOO_EXPORT</span>
<span class="n">FOO_DEPRECATED_VERSION</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Use doFoo2()&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">doFoo</span><span class="p">();</span>
<span class="cp">#endif</span>

<span class="cp">#if FOO_ENABLE_DEPRECATED_SINCE(5, 12)</span>
<span class="cm">/**</span>
<span class="cm">  * @deprecated Since 5.12</span>
<span class="cm">  */</span>
<span class="n">FOO_EXPORT</span>
<span class="n">FOO_DEPRECATED_VERSION</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Use doBar2()&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">doBar</span><span class="p">();</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Projects linking against the “Foo” library can control which part of its
deprecated API should be hidden to the compiler by adding a definition
using the <code class="docutils literal notranslate"><span class="pre">FOO_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code> macro variable set to the
desired value (in version hex number notation):</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_definitions</span><span class="p">(</span><span class="s">-DFOO_DISABLE_DEPRECATED_BEFORE_AND_AT=0x050000</span><span class="p">)</span>
</pre></div>
</div>
<p>Or using the macro variable of the group:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_definitions</span><span class="p">(</span><span class="s">-DBAR_DISABLE_DEPRECATED_BEFORE_AND_AT=0x050000</span><span class="p">)</span>
</pre></div>
</div>
<p>If both are specified, <code class="docutils literal notranslate"><span class="pre">FOO_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code> will take
precedence.</p>
<p>To build a variant of a library with some deprecated API completely left
out from the build, not only optionally invisible to consumers, one uses the
<code class="docutils literal notranslate"><span class="pre">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span></code> parameter. This is best combined with a
cached CMake variable.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">STRING</span><span class="w"> </span><span class="s2">&quot;Control the range of deprecated API excluded from the build [default=0].&quot;</span><span class="p">)</span>

<span class="nb">ecm_generate_export_header</span><span class="p">(</span><span class="s">foo</span>
<span class="w">    </span><span class="s">VERSION</span><span class="w"> </span><span class="o">${</span><span class="nv">FOO_VERSION</span><span class="o">}</span>
<span class="w">    </span><span class="s">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span><span class="w"> </span><span class="o">${</span><span class="nv">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span><span class="o">}</span>
<span class="w">    </span><span class="s">DEPRECATION_VERSIONS</span><span class="w"> </span><span class="s">5.0</span><span class="w"> </span><span class="s">5.12</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The macros used in the headers for library consumers are reused for
disabling the API excluded in the build of the library. For disabling the
implementation of that API as well as for disabling deprecated API which
only can be disabled at build time of the library for BC reasons, one
uses the generated macro <code class="docutils literal notranslate"><span class="pre">FOO_BUILD_DEPRECATED_SINCE</span></code>, like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;foo_export.h&gt;</span>

<span class="k">enum</span><span class="w"> </span><span class="nc">Bars</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">One</span><span class="p">,</span>
<span class="cp">#if FOO_BUILD_DEPRECATED_SINCE(5, 0)</span>
<span class="w">    </span><span class="n">Two</span><span class="w"> </span><span class="n">FOO_ENUMERATOR_DEPRECATED_VERSION</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Use Three&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// macro available since 5.82</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="n">Three</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#if FOO_ENABLE_DEPRECATED_SINCE(5, 0)</span>
<span class="cm">/**</span>
<span class="cm">  * @deprecated Since 5.0</span>
<span class="cm">  */</span>
<span class="n">FOO_EXPORT</span>
<span class="n">FOO_DEPRECATED_VERSION</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Use doFoo2()&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">doFoo</span><span class="p">();</span>
<span class="cp">#endif</span>

<span class="cp">#if FOO_ENABLE_DEPRECATED_SINCE(5, 12)</span>
<span class="cm">/**</span>
<span class="cm">  * @deprecated Since 5.12</span>
<span class="cm">  */</span>
<span class="n">FOO_EXPORT</span>
<span class="n">FOO_DEPRECATED_VERSION</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Use doBar2()&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">doBar</span><span class="p">();</span>
<span class="cp">#endif</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FOO_EXPORT</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="cp">#if FOO_BUILD_DEPRECATED_SINCE(5, 0)</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">      * @deprecated Since 5.0</span>
<span class="cm">      */</span>
<span class="w">    </span><span class="n">FOO_DEPRECATED_VERSION</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Feature removed&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">doWhat</span><span class="p">();</span>
<span class="cp">#endif</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#if FOO_BUILD_DEPRECATED_SINCE(5, 0)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">doFoo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// [...]</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#if FOO_BUILD_DEPRECATED_SINCE(5, 12)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">doBar</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// [...]</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#if FOO_BUILD_DEPRECATED_SINCE(5, 0)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">Foo::doWhat</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// [...]</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>So e.g. if <code class="docutils literal notranslate"><span class="pre">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span></code> is set to “5.0.0”, the
enumerator <code class="docutils literal notranslate"><span class="pre">Two</span></code> as well as the methods <code class="docutils literal notranslate"><span class="pre">::doFoo()</span></code> and <code class="docutils literal notranslate"><span class="pre">Foo::doWhat()</span></code>
will be not available to library consumers. The methods will not have been
compiled into the library binary, and the declarations will be hidden to the
compiler, <code class="docutils literal notranslate"><span class="pre">FOO_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code> also cannot be used to
reactivate them.</p>
<p>When using the <code class="docutils literal notranslate"><span class="pre">NO_DEFINITION_EXPORT_TO_BUILD_INTERFACE</span></code> and the project
for the “Foo” library includes also tests and examples linking against the
library and using deprecated API (like tests covering it), one better
explicitly sets <code class="docutils literal notranslate"><span class="pre">FOO_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code> for those targets
to the version before and at which all deprecated API has been excluded from
the build.
Even more when building against other libraries from the same group “Bar” and
disabling some deprecated API of those libraries using the group macro
<code class="docutils literal notranslate"><span class="pre">BAR_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code>, which also works as default for
<code class="docutils literal notranslate"><span class="pre">FOO_DISABLE_DEPRECATED_BEFORE_AND_AT</span></code>.</p>
<p>To get the hex number style value the helper macro
<code class="docutils literal notranslate"><span class="pre">ecm_export_header_format_version()</span></code> will be used:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span><span class="w"> </span><span class="s">0</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">STRING</span><span class="w"> </span><span class="s2">&quot;Control what part of deprecated API is excluded from build [default=0].&quot;</span><span class="p">)</span>

<span class="nb">ecm_generate_export_header</span><span class="p">(</span><span class="s">foo</span>
<span class="w">    </span><span class="s">VERSION</span><span class="w"> </span><span class="o">${</span><span class="nv">FOO_VERSION</span><span class="o">}</span>
<span class="w">    </span><span class="s">GROUP_BASE_NAME</span><span class="w"> </span><span class="s">BAR</span>
<span class="w">    </span><span class="s">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span><span class="w"> </span><span class="o">${</span><span class="nv">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span><span class="o">}</span>
<span class="w">    </span><span class="s">NO_DEFINITION_EXPORT_TO_BUILD_INTERFACE</span>
<span class="w">    </span><span class="s">DEPRECATION_VERSIONS</span><span class="w"> </span><span class="s">5.0</span><span class="w"> </span><span class="s">5.12</span>
<span class="p">)</span>

<span class="nb">ecm_export_header_format_version</span><span class="p">(</span><span class="o">${</span><span class="nv">EXCLUDE_DEPRECATED_BEFORE_AND_AT</span><span class="o">}</span>
<span class="w">    </span><span class="s">CURRENT_VERSION</span><span class="w"> </span><span class="o">${</span><span class="nv">FOO_VERSION</span><span class="o">}</span>
<span class="w">    </span><span class="s">HEXNUMBER_VAR</span><span class="w"> </span><span class="s">foo_no_deprecated_before_and_at</span>
<span class="p">)</span>

<span class="c"># disable all deprecated API up to 5.9.0 from all other libs of group &quot;BAR&quot; that we use ourselves</span>
<span class="nb">add_definitions</span><span class="p">(</span><span class="s">-DBAR_DISABLE_DEPRECATED_BEFORE_AND_AT=0x050900</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="s">app</span><span class="w"> </span><span class="s">app.cpp</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">app</span><span class="w"> </span><span class="s">foo</span><span class="p">)</span>
<span class="nb">target_compile_definitions</span><span class="p">(</span><span class="s">app</span>
<span class="w">     </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s2">&quot;FOO_DISABLE_DEPRECATED_BEFORE_AND_AT=${foo_no_deprecated_before_and_at}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Since 5.64.0.</p>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="ECMGenerateDBusServiceFile.html"
                          title="previous chapter">ECMGenerateDBusServiceFile</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="ECMGenerateHeaders.html"
                          title="next chapter">ECMGenerateHeaders</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/module/ECMGenerateExportHeader.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ECMGenerateHeaders.html" title="ECMGenerateHeaders"
             >next</a> |</li>
        <li class="right" >
          <a href="ECMGenerateDBusServiceFile.html" title="ECMGenerateDBusServiceFile"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">ECM 5.240 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../manual/ecm-modules.7.html" >ecm-modules(7)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ECMGenerateExportHeader</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright KDE Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.0.
    </div>
  </body>
</html>